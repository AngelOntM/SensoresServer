"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const Sensor_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Models/Sensor"));
const mongoose = require('mongoose');
const { Schema } = mongoose;
mongoose.connect('mongodb://localhost:27017/proyecto');
const carros = new Schema({
    id: Number,
    pines: Array,
    clave: String,
    isActive: Boolean,
    seccion: Number,
    invernadero: Number,
    data: Array,
    created_at: Date,
    updated_at: Date,
    store: Boolean,
});
const carrito = mongoose.model('sensores', carros);
class CarritosController {
    async index({ response }) {
        const find = await carrito.find();
        console.log(find);
        return response.json({ find });
    }
    async show({ response, params }) {
        const find = await carrito.find({ 'id': params.id });
        return response.json({ find });
    }
    async store({ request, response }) {
        const validatedData = await Sensor_1.default.validar(request);
        var dato = await new carrito({
            id: await carrito.count(),
            pines: validatedData.pines,
            clave: validatedData.clave,
            isActive: validatedData.isActive,
            seccion: validatedData.seccion,
            invernadero: validatedData.invernadero,
            data: [],
            created_at: Date.now(),
            updated_at: Date.now(),
            store: true,
        });
        await dato.save();
        return response.json({ dato });
    }
    async update({ response, request, params }) {
        const validatedData = await Sensor_1.default.validar(request);
        var dato = await new carrito({
            id: params.id,
            pines: validatedData.pines,
            clave: validatedData.clave,
            isActive: validatedData.isActive,
            seccion: validatedData.seccion,
            invernadero: validatedData.invernadero,
            data: [],
            updated_at: Date.now(),
            store: true,
        });
        const find = await carrito.findOne({ 'id': params.id });
        await find.update({ id: dato.id, pines: dato.pines, clave: dato.clave, isActive: dato.isActive, seccion: dato.seccion, invernadero: dato.invernadero, updated_at: dato.updated_at });
        await find.save();
        return response.json({ find });
    }
    async destroy({ response, params }) {
        const dato = await carrito.findOne({ 'id': params.id });
        await carrito.deleteOne({ 'id': params.id });
        await dato.delete();
        return response
            .status(200)
            .send({ message: 'Registro Eliminado' });
    }
    async storedata({ response, request, params }) {
        const validatedData = await Sensor_1.default.validar1(request);
        const find = await carrito.findOne({ 'id': params.id });
        await find.updateOne({ '$push': { data: { id: validatedData.id, fecha: validatedData.fecha, hora: validatedData.hora, valor: validatedData.valor, medida: validatedData.medida, nombre: validatedData.nombre, save: true } } });
        await find.save();
        const find1 = await carrito.findOne({ 'id': params.id });
        return response.json({ find1 });
    }
}
exports.default = CarritosController;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2Vuc29yZXNDb250cm9sbGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiU2Vuc29yZXNDb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQ0EscUZBQXdDO0FBQ3hDLE1BQU0sUUFBUSxHQUFHLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQztBQUNyQyxNQUFNLEVBQUUsTUFBTSxFQUFFLEdBQUcsUUFBUSxDQUFDO0FBQzVCLFFBQVEsQ0FBQyxPQUFPLENBQUMsb0NBQW9DLENBQUMsQ0FBQztBQUN2RCxNQUFNLE1BQU0sR0FBRyxJQUFJLE1BQU0sQ0FBQztJQUN4QixFQUFFLEVBQUUsTUFBTTtJQUNWLEtBQUssRUFBRSxLQUFLO0lBQ1osS0FBSyxFQUFFLE1BQU07SUFDYixRQUFRLEVBQUUsT0FBTztJQUNqQixPQUFPLEVBQUUsTUFBTTtJQUNmLFdBQVcsRUFBRSxNQUFNO0lBQ25CLElBQUksRUFBRSxLQUFLO0lBQ1gsVUFBVSxFQUFFLElBQUk7SUFDaEIsVUFBVSxFQUFFLElBQUk7SUFDaEIsS0FBSyxFQUFFLE9BQU87Q0FFZixDQUFDLENBQUM7QUFDSCxNQUFNLE9BQU8sR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDLFVBQVUsRUFBRSxNQUFNLENBQUMsQ0FBQTtBQUVsRCxNQUFxQixrQkFBa0I7SUFDOUIsS0FBSyxDQUFDLEtBQUssQ0FBQyxFQUFFLFFBQVEsRUFBdUI7UUFDbEQsTUFBTSxJQUFJLEdBQUcsTUFBTSxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUE7UUFDakMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQTtRQUNqQixPQUFPLFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFBO0lBQ2hDLENBQUM7SUFFTSxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBdUI7UUFDekQsTUFBTSxJQUFJLEdBQUcsTUFBTSxPQUFPLENBQUMsSUFBSSxD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dENvbnRyYWN0IH0gZnJvbSAnQGlvYzpBZG9uaXMvQ29yZS9IdHRwQ29udGV4dCdcbmltcG9ydCBDYXJyaXRvIGZyb20gJ0FwcC9Nb2RlbHMvU2Vuc29yJztcbmNvbnN0IG1vbmdvb3NlID0gcmVxdWlyZSgnbW9uZ29vc2UnKTtcbmNvbnN0IHsgU2NoZW1hIH0gPSBtb25nb29zZTtcbm1vbmdvb3NlLmNvbm5lY3QoJ21vbmdvZGI6Ly9sb2NhbGhvc3Q6MjcwMTcvcHJveWVjdG8nKTtcbmNvbnN0IGNhcnJvcyA9IG5ldyBTY2hlbWEoe1xuICBpZDogTnVtYmVyLFxuICBwaW5lczogQXJyYXksXG4gIGNsYXZlOiBTdHJpbmcsXG4gIGlzQWN0aXZlOiBCb29sZWFuLFxuICBzZWNjaW9uOiBOdW1iZXIsXG4gIGludmVybmFkZXJvOiBOdW1iZXIsXG4gIGRhdGE6IEFycmF5LFxuICBjcmVhdGVkX2F0OiBEYXRlLFxuICB1cGRhdGVkX2F0OiBEYXRlLFxuICBzdG9yZTogQm9vbGVhbixcblxufSk7XG5jb25zdCBjYXJyaXRvID0gbW9uZ29vc2UubW9kZWwoJ3NlbnNvcmVzJywgY2Fycm9zKVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDYXJyaXRvc0NvbnRyb2xsZXIge1xuICBwdWJsaWMgYXN5bmMgaW5kZXgoeyByZXNwb25zZSB9OiBIdHRwQ29udGV4dENvbnRyYWN0KSB7XG4gICAgY29uc3QgZmluZCA9IGF3YWl0IGNhcnJpdG8uZmluZCgpXG4gICAgY29uc29sZS5sb2coZmluZClcbiAgICByZXR1cm4gcmVzcG9uc2UuanNvbih7IGZpbmQgfSlcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBzaG93KHsgcmVzcG9uc2UsIHBhcmFtcyB9OiBIdHRwQ29udGV4dENvbnRyYWN0KSB7XG4gICAgY29uc3QgZmluZCA9IGF3YWl0IGNhcnJpdG8uZmluZCh7ICdpZCc6IHBhcmFtcy5pZCB9KVxuICAgIHJldHVybiByZXNwb25zZS5qc29uKHsgZmluZCB9KVxuICB9XG5cbiAgcHVibGljIGFzeW5jIHN0b3JlKHsgcmVxdWVzdCwgcmVzcG9uc2UgfTogSHR0cENvbnRleHRDb250cmFjdCkge1xuICAgIGNvbnN0IHZhbGlkYXRlZERhdGEgPSBhd2FpdCBDYXJyaXRvLnZhbGlkYXIocmVxdWVzdClcbiAgICB2YXIgZGF0byA9IGF3YWl0IG5ldyBjYXJyaXRvKHtcbiAgICAgIGlkOiBhd2FpdCBjYXJyaXRvLmNvdW50KCksXG4gICAgICBwaW5lczogdmFsaWRhdGVkRGF0YS5waW5lcyxcbiAgICAgIGNsYXZlOiB2YWxpZGF0ZWREYXRhLmNsYXZlLFxuICAgICAgaXNBY3RpdmU6IHZhbGlkYXRlZERhdGEuaXNBY3RpdmUsXG4gICAgICBzZWNjaW9uOiB2YWxpZGF0ZWREYXRhLnNlY2Npb24sXG4gICAgICBpbnZlcm5hZGVybzogdmFsaWRhdGVkRGF0YS5pbnZlcm5hZGVybyxcbiAgICAgIGRhdGE6IFtdLFxuICAgICAgY3JlYXRlZF9hdDogRGF0ZS5ub3coKSxcbiAgICAgIHVwZGF0ZWRfYXQ6IERhdGUubm93KCksXG4gICAgICBzdG9yZTogdHJ1ZSxcbiAgICB9KTtcbiAgICBhd2FpdCBkYXRvLnNhdmUoKVxuICAgIHJldHVybiByZXNwb25zZS5qc29uKHsgZGF0byB9KVxuICB9XG5cbiAgcHVibGljIGFzeW5jIHVwZGF0ZSh7IHJlc3BvbnNlLCByZXF1ZXN0LCBwYXJhbXMgfTogSHR0cENvbnRleHRDb250cmFjdCkge1xuICAgIGNvbnN0IHZhbGlkYXRlZERhdGEgPSBhd2FpdCBDYXJyaXRvLnZhbGlkYXIocmVxdWVzdClcbiAgICB2YXIgZGF0byA9IGF3YWl0IG5ldyBjYXJyaXRvKHtcbiAgICAgIGlkOiBwYXJhbXMuaWQsXG4gICAgICBwaW5lczogdmFsaWRhdGVkRGF0YS5waW5lcyxcbiAgICAgIGNsYXZlOiB2YWxpZGF0ZWREYXRhLmNsYXZlLFxuICAgICAgaXNBY3RpdmU6IHZhbGlkYXRlZERhdGEuaXNBY3RpdmUsXG4gICAgICBzZWNjaW9uOiB2YWxpZGF0ZWREYXRhLnNlY2Npb24sXG4gICAgICBpbnZlcm5hZGVybzogdmFsaWRhdGVkRGF0YS5pbnZlcm5hZGVybyxcbiAgICAgIGRhdGE6IFtdLFxuICAgICAgdXBkYXRlZF9hdDogRGF0ZS5ub3coKSxcbiAgICAgIHN0b3JlOiB0cnVlLFxuICAgIH0pO1xuICAgIGNvbnN0IGZpbmQgPSBhd2FpdCBjYXJyaXRvLmZpbmRPbmUoeyAnaWQnOiBwYXJhbXMuaWQgfSlcbiAgICBhd2FpdCBmaW5kLnVwZGF0ZSh7IGlkOiBkYXRvLmlkLCBwaW5lczogZGF0by5waW5lcywgY2xhdmU6IGRhdG8uY2xhdmUsIGlzQWN0aXZlOiBkYXRvLmlzQWN0aXZlLCBzZWNjaW9uOiBkYXRvLnNlY2Npb24sIGludmVybmFkZXJvOiBkYXRvLmludmVybmFkZXJvLCB1cGRhdGVkX2F0OiBkYXRvLnVwZGF0ZWRfYXQgfSlcbiAgICBhd2FpdCBmaW5kLnNhdmUoKVxuICAgIHJldHVybiByZXNwb25zZS5qc29uKHsgZmluZCB9KVxuICB9XG5cbiAgcHVibGljIGFzeW5jIGRlc3Ryb3koeyByZXNwb25zZSwgcGFyYW1zIH06IEh0dHBDb250ZXh0Q29udHJhY3QpIHtcbiAgICBjb25zdCBkYXRvID0gYXdhaXQgY2Fycml0by5maW5kT25lKHsgJ2lkJzogcGFyYW1zLmlkIH0pXG4gICAgYXdhaXQgY2Fycml0by5kZWxldGVPbmUoeyAnaWQnOiBwYXJhbXMuaWQgfSlcbiAgICBhd2FpdCBkYXRvLmRlbGV0ZSgpXG4gICAgcmV0dXJuIHJlc3BvbnNlXG4gICAgICAuc3RhdHVzKDIwMClcbiAgICAgIC5zZW5kKHsgbWVzc2FnZTogJ1JlZ2lzdHJvIEVsaW1pbmFkbycgfSlcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBzdG9yZWRhdGEoeyByZXNwb25zZSwgcmVxdWVzdCwgcGFyYW1zIH06IEh0dHBDb250ZXh0Q29udHJhY3QpIHtcbiAgICBjb25zdCB2YWxpZGF0ZWREYXRhID0gYXdhaXQgQ2Fycml0by52YWxpZGFyMShyZXF1ZXN0KVxuICAgIGNvbnN0IGZpbmQgPSBhd2FpdCBjYXJyaXRvLmZpbmRPbmUoeyAnaWQnOiBwYXJhbXMuaWQgfSlcbiAgICBhd2FpdCBmaW5kLnVwZGF0ZU9uZSh7ICckcHVzaCc6IHsgZGF0YTogeyBpZDogdmFsaWRhdGVkRGF0YS5pZCwgZmVjaGE6IHZhbGlkYXRlZERhdGEuZmVjaGEsIGhvcmE6IHZhbGlkYXRlZERhdGEuaG9yYSwgdmFsb3I6IHZhbGlkYXRlZERhdGEudmFsb3IsIG1lZGlkYTogdmFsaWRhdGVkRGF0YS5tZWRpZGEsIG5vbWJyZTogdmFsaWRhdGVkRGF0YS5ub21icmUsIHNhdmU6IHRydWUgfSB9IH0pXG4gICAgYXdhaXQgZmluZC5zYXZlKClcbiAgICBjb25zdCBmaW5kMSA9IGF3YWl0IGNhcnJpdG8uZmluZE9uZSh7ICdpZCc6IHBhcmFtcy5pZCB9KVxuICAgIHJldHVybiByZXNwb25zZS5qc29uKHsgZmluZDEgfSlcbiAgfVxufVxuIl19