"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const Sensor_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Models/Sensor"));
const mongoose = require('mongoose');
const { Schema } = mongoose;
mongoose.connect('mongodb+srv://admin:admin@sensores.gr9v5.mongodb.net/proyecto?retryWrites=true&w=majority');
const carros = new Schema({
    id: Number,
    pines: Array,
    clave: String,
    isActive: Boolean,
    seccion: Number,
    invernadero: Number,
    data: Array,
    created_at: Date,
    updated_at: Date,
    store: Boolean,
});
const carrito = mongoose.model('sensores', carros);
class CarritosController {
    async index({ response }) {
        const find = await carrito.find();
        console.log(await carrito.count());
        return response.json({ find });
    }
    async show({ response, params }) {
        const find = await carrito.find({ 'id': params.id });
        return response.json({ find });
    }
    async store({ request, response }) {
        const validatedData = await Sensor_1.default.validar(request);
        var dato = await new carrito({
            id: await carrito.count(),
            pines: validatedData.pines,
            clave: validatedData.clave,
            isActive: validatedData.isActive,
            seccion: validatedData.seccion,
            invernadero: validatedData.invernadero,
            data: [],
            created_at: Date.now(),
            updated_at: Date.now(),
            store: true,
        });
        await dato.save();
        return response.json({ dato });
    }
    async update({ response, request, params }) {
        const validatedData = await Sensor_1.default.validar(request);
        var dato = await new carrito({
            id: params.id,
            pines: validatedData.pines,
            clave: validatedData.clave,
            isActive: validatedData.isActive,
            seccion: validatedData.seccion,
            invernadero: validatedData.invernadero,
            data: [],
            updated_at: Date.now(),
            store: true,
        });
        const find = await carrito.findOne({ 'id': params.id });
        await find.update({ id: dato.id, pines: dato.pines, clave: dato.clave, isActive: dato.isActive, seccion: dato.seccion, invernadero: dato.invernadero, updated_at: dato.updated_at });
        await find.save();
        return response.json({ find });
    }
    async destroy({ response, params }) {
        const dato = await carrito.findOne({ '_id': params.id });
        await carrito.deleteOne({ 'id': params.id });
        await dato.save();
        return response
            .status(200)
            .send({ message: 'Registro Eliminado' });
    }
    async storedata({ response, request, params }) {
        const validatedData = await Sensor_1.default.validar1(request);
        const find = await carrito.findOne({ 'id': params.id });
        await find.update({ '$push': { data: { id: validatedData.id, fecha: validatedData.fecha, hora: validatedData.hora, valor: validatedData.valor, medida: validatedData.medida, nombre: validatedData.nombre, save: validatedData.save } } });
        await find.save();
        return response.json({ find });
    }
}
exports.default = CarritosController;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2Vuc29yZXNDb250cm9sbGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiU2Vuc29yZXNDb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQ0EscUZBQXdDO0FBQ3hDLE1BQU0sUUFBUSxHQUFHLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQztBQUNyQyxNQUFNLEVBQUUsTUFBTSxFQUFFLEdBQUcsUUFBUSxDQUFDO0FBQzVCLFFBQVEsQ0FBQyxPQUFPLENBQUMsMkZBQTJGLENBQUMsQ0FBQztBQUM5RyxNQUFNLE1BQU0sR0FBRyxJQUFJLE1BQU0sQ0FBQztJQUN4QixFQUFFLEVBQUUsTUFBTTtJQUNWLEtBQUssRUFBRSxLQUFLO0lBQ1osS0FBSyxFQUFFLE1BQU07SUFDYixRQUFRLEVBQUUsT0FBTztJQUNqQixPQUFPLEVBQUUsTUFBTTtJQUNmLFdBQVcsRUFBRSxNQUFNO0lBQ25CLElBQUksRUFBRSxLQUFLO0lBQ1gsVUFBVSxFQUFFLElBQUk7SUFDaEIsVUFBVSxFQUFFLElBQUk7SUFDaEIsS0FBSyxFQUFFLE9BQU87Q0FFZixDQUFDLENBQUM7QUFDSCxNQUFNLE9BQU8sR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDLFVBQVUsRUFBRSxNQUFNLENBQUMsQ0FBQTtBQUVsRCxNQUFxQixrQkFBa0I7SUFDOUIsS0FBSyxDQUFDLEtBQUssQ0FBQyxFQUFFLFFBQVEsRUFBdUI7UUFDbEQsTUFBTSxJQUFJLEdBQUcsTUFBTSxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUE7UUFDakMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFBO1FBQ2xDLE9BQU8sUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUE7SUFDaEMsQ0FBQztJQUVNLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUF1QjtRQUN6RCxNQUFNLElBQUksR0FBRyxN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QUFDLEVBQUUsRUFBRSxDQUFDLENBQUE7UUFDNUMsTUFBTSxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUE7UUFDakIsT0FBTyxRQUFRO2FBQ1osTUFBTSxDQUFDLEdBQUcsQ0FBQzthQUNYLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxDQUFDLENBQUE7SUFDNUMsQ0FBQztJQUVNLEtBQUssQ0FBQyxTQUFTLENBQUMsRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBdUI7UUFDdkUsTUFBTSxhQUFhLEdBQUcsTUFBTSxnQkFBTyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQTtRQUNyRCxNQUFNLElBQUksR0FBRyxNQUFNLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUE7UUFDdkQsTUFBTSxJQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsT0FBTyxFQUFFLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxFQUFFLGFBQWEsQ0FBQyxFQUFFLEVBQUUsS0FBSyxFQUFFLGFBQWEsQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLGFBQWEsQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLGFBQWEsQ0FBQyxLQUFLLEVBQUUsTUFBTSxFQUFFLGFBQWEsQ0FBQyxNQUFNLEVBQUUsTUFBTSxFQUFFLGFBQWEsQ0FBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLGFBQWEsQ0FBQyxJQUFJLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQTtRQUMxTyxNQUFNLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQTtRQUNqQixPQUFPLFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFBO0lBQ2hDLENBQUM7Q0FDRjtBQWpFRCxxQ0FpRUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IEh0dHBDb250ZXh0Q29udHJhY3QgfSBmcm9tICdAaW9jOkFkb25pcy9Db3JlL0h0dHBDb250ZXh0J1xuaW1wb3J0IENhcnJpdG8gZnJvbSAnQXBwL01vZGVscy9TZW5zb3InO1xuY29uc3QgbW9uZ29vc2UgPSByZXF1aXJlKCdtb25nb29zZScpO1xuY29uc3QgeyBTY2hlbWEgfSA9IG1vbmdvb3NlO1xubW9uZ29vc2UuY29ubmVjdCgnbW9uZ29kYitzcnY6Ly9hZG1pbjphZG1pbkBzZW5zb3Jlcy5ncjl2NS5tb25nb2RiLm5ldC9wcm95ZWN0bz9yZXRyeVdyaXRlcz10cnVlJnc9bWFqb3JpdHknKTtcbmNvbnN0IGNhcnJvcyA9IG5ldyBTY2hlbWEoe1xuICBpZDogTnVtYmVyLFxuICBwaW5lczogQXJyYXksXG4gIGNsYXZlOiBTdHJpbmcsXG4gIGlzQWN0aXZlOiBCb29sZWFuLFxuICBzZWNjaW9uOiBOdW1iZXIsXG4gIGludmVybmFkZXJvOiBOdW1iZXIsXG4gIGRhdGE6IEFycmF5LFxuICBjcmVhdGVkX2F0OiBEYXRlLFxuICB1cGRhdGVkX2F0OiBEYXRlLFxuICBzdG9yZTogQm9vbGVhbixcblxufSk7XG5jb25zdCBjYXJyaXRvID0gbW9uZ29vc2UubW9kZWwoJ3NlbnNvcmVzJywgY2Fycm9zKVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDYXJyaXRvc0NvbnRyb2xsZXIge1xuICBwdWJsaWMgYXN5bmMgaW5kZXgoeyByZXNwb25zZSB9OiBIdHRwQ29udGV4dENvbnRyYWN0KSB7XG4gICAgY29uc3QgZmluZCA9IGF3YWl0IGNhcnJpdG8uZmluZCgpXG4gICAgY29uc29sZS5sb2coYXdhaXQgY2Fycml0by5jb3VudCgpKVxuICAgIHJldHVybiByZXNwb25zZS5qc29uKHsgZmluZCB9KVxuICB9XG5cbiAgcHVibGljIGFzeW5jIHNob3coeyByZXNwb25zZSwgcGFyYW1zIH06IEh0dHBDb250ZXh0Q29udHJhY3QpIHtcbiAgICBjb25zdCBmaW5kID0gYXdhaXQgY2Fycml0by5maW5kKHsgJ2lkJzogcGFyYW1zLmlkIH0pXG4gICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oeyBmaW5kIH0pXG4gIH1cblxuICBwdWJsaWMgYXN5bmMgc3RvcmUoeyByZXF1ZXN0LCByZXNwb25zZSB9OiBIdHRwQ29udGV4dENvbnRyYWN0KSB7XG4gICAgY29uc3QgdmFsaWRhdGVkRGF0YSA9IGF3YWl0IENhcnJpdG8udmFsaWRhcihyZXF1ZXN0KVxuICAgIHZhciBkYXRvID0gYXdhaXQgbmV3IGNhcnJpdG8oe1xuICAgICAgaWQ6IGF3YWl0IGNhcnJpdG8uY291bnQoKSxcbiAgICAgIHBpbmVzOiB2YWxpZGF0ZWREYXRhLnBpbmVzLFxuICAgICAgY2xhdmU6IHZhbGlkYXRlZERhdGEuY2xhdmUsXG4gICAgICBpc0FjdGl2ZTogdmFsaWRhdGVkRGF0YS5pc0FjdGl2ZSxcbiAgICAgIHNlY2Npb246IHZhbGlkYXRlZERhdGEuc2VjY2lvbixcbiAgICAgIGludmVybmFkZXJvOiB2YWxpZGF0ZWREYXRhLmludmVybmFkZXJvLFxuICAgICAgZGF0YTogW10sXG4gICAgICBjcmVhdGVkX2F0OiBEYXRlLm5vdygpLFxuICAgICAgdXBkYXRlZF9hdDogRGF0ZS5ub3coKSxcbiAgICAgIHN0b3JlOiB0cnVlLFxuICAgIH0pO1xuICAgIGF3YWl0IGRhdG8uc2F2ZSgpXG4gICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oeyBkYXRvIH0pXG4gIH1cblxuICBwdWJsaWMgYXN5bmMgdXBkYXRlKHsgcmVzcG9uc2UsIHJlcXVlc3QsIHBhcmFtcyB9OiBIdHRwQ29udGV4dENvbnRyYWN0KSB7XG4gICAgY29uc3QgdmFsaWRhdGVkRGF0YSA9IGF3YWl0IENhcnJpdG8udmFsaWRhcihyZXF1ZXN0KVxuICAgIHZhciBkYXRvID0gYXdhaXQgbmV3IGNhcnJpdG8oe1xuICAgICAgaWQ6IHBhcmFtcy5pZCxcbiAgICAgIHBpbmVzOiB2YWxpZGF0ZWREYXRhLnBpbmVzLFxuICAgICAgY2xhdmU6IHZhbGlkYXRlZERhdGEuY2xhdmUsXG4gICAgICBpc0FjdGl2ZTogdmFsaWRhdGVkRGF0YS5pc0FjdGl2ZSxcbiAgICAgIHNlY2Npb246IHZhbGlkYXRlZERhdGEuc2VjY2lvbixcbiAgICAgIGludmVybmFkZXJvOiB2YWxpZGF0ZWREYXRhLmludmVybmFkZXJvLFxuICAgICAgZGF0YTogW10sXG4gICAgICB1cGRhdGVkX2F0OiBEYXRlLm5vdygpLFxuICAgICAgc3RvcmU6IHRydWUsXG4gICAgfSk7XG4gICAgY29uc3QgZmluZCA9IGF3YWl0IGNhcnJpdG8uZmluZE9uZSh7ICdpZCc6IHBhcmFtcy5pZCB9KVxuICAgIGF3YWl0IGZpbmQudXBkYXRlKHsgaWQ6IGRhdG8uaWQsIHBpbmVzOiBkYXRvLnBpbmVzLCBjbGF2ZTogZGF0by5jbGF2ZSwgaXNBY3RpdmU6IGRhdG8uaXNBY3RpdmUsIHNlY2Npb246IGRhdG8uc2VjY2lvbiwgaW52ZXJuYWRlcm86IGRhdG8uaW52ZXJuYWRlcm8sIHVwZGF0ZWRfYXQ6IGRhdG8udXBkYXRlZF9hdCB9KVxuICAgIGF3YWl0IGZpbmQuc2F2ZSgpXG4gICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oeyBmaW5kIH0pXG4gIH1cblxuICBwdWJsaWMgYXN5bmMgZGVzdHJveSh7IHJlc3BvbnNlLCBwYXJhbXMgfTogSHR0cENvbnRleHRDb250cmFjdCkge1xuICAgIGNvbnN0IGRhdG8gPSBhd2FpdCBjYXJyaXRvLmZpbmRPbmUoeyAnX2lkJzogcGFyYW1zLmlkIH0pXG4gICAgYXdhaXQgY2Fycml0by5kZWxldGVPbmUoeyAnaWQnOiBwYXJhbXMuaWQgfSlcbiAgICBhd2FpdCBkYXRvLnNhdmUoKVxuICAgIHJldHVybiByZXNwb25zZVxuICAgICAgLnN0YXR1cygyMDApXG4gICAgICAuc2VuZCh7IG1lc3NhZ2U6ICdSZWdpc3RybyBFbGltaW5hZG8nIH0pXG4gIH1cblxuICBwdWJsaWMgYXN5bmMgc3RvcmVkYXRhKHsgcmVzcG9uc2UsIHJlcXVlc3QsIHBhcmFtcyB9OiBIdHRwQ29udGV4dENvbnRyYWN0KSB7XG4gICAgY29uc3QgdmFsaWRhdGVkRGF0YSA9IGF3YWl0IENhcnJpdG8udmFsaWRhcjEocmVxdWVzdClcbiAgICBjb25zdCBmaW5kID0gYXdhaXQgY2Fycml0by5maW5kT25lKHsgJ2lkJzogcGFyYW1zLmlkIH0pXG4gICAgYXdhaXQgZmluZC51cGRhdGUoeyAnJHB1c2gnOiB7IGRhdGE6IHsgaWQ6IHZhbGlkYXRlZERhdGEuaWQsIGZlY2hhOiB2YWxpZGF0ZWREYXRhLmZlY2hhLCBob3JhOiB2YWxpZGF0ZWREYXRhLmhvcmEsIHZhbG9yOiB2YWxpZGF0ZWREYXRhLnZhbG9yLCBtZWRpZGE6IHZhbGlkYXRlZERhdGEubWVkaWRhLCBub21icmU6IHZhbGlkYXRlZERhdGEubm9tYnJlLCBzYXZlOiB2YWxpZGF0ZWREYXRhLnNhdmUgfSB9IH0pXG4gICAgYXdhaXQgZmluZC5zYXZlKClcbiAgICByZXR1cm4gcmVzcG9uc2UuanNvbih7IGZpbmQgfSlcbiAgfVxufVxuIl19